@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import views.html.templates.Layout
@import views.html.templates.helpers.Button
@import views.html.templates.helpers.Heading
@import utils.ViewUtils.summaryListRow
@import models.expenses.ExpensesViewModel
@import utils.ViewUtils.bigDecimalCurrency

@this(
    layout: Layout,
    formWithCSRF: FormWithCSRF,
    button: Button,
    heading: Heading,
    govukSummaryList: GovukSummaryList,
    govukInsetText : GovukInsetText
)

@(taxYear: Int, expenses: ExpensesViewModel, isInYear: Boolean, isMultipleEmployments: Boolean)(implicit user: User[_], messages: Messages, appConfig: AppConfig)

@headingForUse = @{messages(s"checkYourExpenses.heading.${if(user.isAgent) "agent" else "individual"}")}

@titleForUse = @{messages(s"checkYourExpenses.heading.${if(user.isAgent) "agent" else "individual"}")}

@hiddenText(item:String) = @{Some(messages(s"$item.hiddenText.${if(user.isAgent) "agent" else "individual"}"))}

@showRows(item: String, value: BigDecimal, route: Call = controllers.employment.routes.CheckEmploymentExpensesController.show(taxYear)) = @{
    summaryListRow(HtmlContent(messages(item)),HtmlContent(bigDecimalCurrency(value.toString)),actions = Seq((route, messages("common.change"), hiddenText(item))), keyClasses="govuk-!-width-two-thirds")
}

@showQuestionRow(item: String, value: Boolean, route: Call = controllers.employment.routes.CheckEmploymentExpensesController.show(taxYear)) = @{
    summaryListRow(HtmlContent(messages(item)),HtmlContent(if(value){messages("common.yes")} else {messages("common.no")}),actions = Seq((route, messages("common.change"), hiddenText(item))), keyClasses="govuk-!-width-two-thirds")
}

@layout(pageTitle = titleForUse, taxYear = Some(taxYear)) {

    @heading(headingForUse, Some(messages("employment.caption", (taxYear - 1).toString, taxYear.toString)), "govuk-!-margin-bottom-5")

    @if(expenses.isUsingCustomerData == false){
        <p class="govuk-body">@messages(s"checkYourExpenses.hmrcOnlyInfo.${if(user.isAgent) "agent" else "individual"}")</p>
    }

    @if(isMultipleEmployments){
        <p class="govuk-inset-text">
            @messages(s"checkYourExpenses.multiple.${if(user.isAgent) "agent" else "individual"}")
        </p>
    }

    @{
        val header: Seq[SummaryListRow] = Seq(showQuestionRow("checkYourExpenses.employmentExpenses", expenses.claimingEmploymentExpenses, controllers.expenses.routes.EmploymentExpensesController.submit(taxYear)))
        val rows: Seq[SummaryListRow] =
            Seq(
                expenses.jobExpensesQuestion.map{
                    jobExpensesQuestion => showQuestionRow("checkYourExpenses.jobExpensesQuestion", jobExpensesQuestion, controllers.expenses.routes.BusinessTravelOvernightExpensesController.show(taxYear))
                },
                expenses.jobExpenses.map{
                    jobExpenses => showRows("checkYourExpenses.jobExpensesAmount", jobExpenses, controllers.expenses.routes.TravelAndOvernightAmountController.show(taxYear))
                },
                expenses.flatRateJobExpensesQuestion.map{
                    flatRateJobExpensesQuestion => showQuestionRow("checkYourExpenses.flatRateJobExpensesQuestion", flatRateJobExpensesQuestion, controllers.expenses.routes.UniformsOrToolsExpensesController.show(taxYear))
                },
                expenses.flatRateJobExpenses.map{
                    flatRateJobExpenses => showRows("checkYourExpenses.flatRateJobExpensesAmount", flatRateJobExpenses, controllers.expenses.routes.UniformsOrToolsExpensesAmountController.show(taxYear))
                },
                expenses.professionalSubscriptionsQuestion.map{
                    professionalSubscriptionsQuestion => showQuestionRow("checkYourExpenses.professionalSubscriptionsQuestion", professionalSubscriptionsQuestion,controllers.expenses.routes.ProfessionalFeesAndSubscriptionsExpensesController.show(taxYear))
                },
                expenses.professionalSubscriptions.map{
                    professionalSubscriptions => showRows("checkYourExpenses.professionalSubscriptionsAmount", professionalSubscriptions)
                },
                expenses.otherAndCapitalAllowancesQuestion.map{
                    otherAndCapitalAllowancesQuestion => showQuestionRow("checkYourExpenses.otherAndCapitalAllowancesQuestion", otherAndCapitalAllowancesQuestion)
                },
                expenses.otherAndCapitalAllowances.map{
                    otherAndCapitalAllowances => showRows("checkYourExpenses.otherAndCapitalAllowancesAmount", otherAndCapitalAllowances)
                }
            ).flatten

        if(expenses.claimingEmploymentExpenses){
            govukSummaryList(SummaryList(header ++ rows))
        } else {
            govukSummaryList(SummaryList(header))
        }

    }

    @button("common.saveAndContinue", classes = Some("govuk-!-margin-top-6"))
}

@{
// $COVERAGE-OFF$
}
