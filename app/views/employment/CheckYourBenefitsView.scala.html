@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import views.html.templates.Layout
@import views.html.templates.helpers.Button
@import views.html.templates.helpers.Heading
@import utils.ViewUtils.summaryListRow
@import models.benefits.Benefits
@import utils.ViewUtils.bigDecimalCurrency

@this(
    layout: Layout,
    formWithCSRF: FormWithCSRF,
    button: Button,
    heading: Heading,
    govukSummaryList: GovukSummaryList,
    govukInsetText: GovukInsetText,
    govUkButton: GovukButton
)

@(taxYear: Int, benefits: Benefits, isSingleEmployment: Boolean, isInYear: Boolean, employmentId: String)(implicit user: User[_], messages: Messages, appConfig: AppConfig)

@headingForUse = @{messages(s"checkYourBenefits.heading.${if(user.isAgent) "agent" else "individual"}")}

@titleForUse = @{messages(s"checkYourBenefits.heading.${if(user.isAgent) "agent" else "individual"}")}

@employmentSource = @{

        if(isSingleEmployment) {
            govUkButton(Button(
            attributes = Map("id" -> "returnToEmploymentSummaryBtn"),
            preventDoubleClick = true,
            content = Text(messages("employment.employmentInfo.buttonText")),
            classes = "govuk-button",
            href = Some(controllers.employment.routes.EmploymentSummaryController.show(taxYear).url)
        ))
            } else {
                govUkButton(Button(
                attributes = Map("id" -> "returnToEmployerBtn"),
                preventDoubleClick = true,
                content = Text(messages("common.returnToEmployer")),
                classes = "govuk-button",
                href = Some(controllers.employment.routes.EmploymentDetailsAndBenefitsController.show(taxYear, employmentId).url)
            ))
        }
}

@showRows(item: String, value: Option[BigDecimal]) = @{
    summaryListRow(HtmlContent(messages(item)),HtmlContent(bigDecimalCurrency(value.getOrElse("0").toString)),actions = Seq(), keyClasses="govuk-!-width-two-thirds", valueClasses = "govuk-!-width-one-third right-align")
}

@layout(pageTitle = titleForUse, taxYear = Some(taxYear)) {

    @heading(headingForUse, Some(messages("employment.caption", (taxYear - 1).toString, taxYear.toString)), "govuk-!-margin-bottom-5")

    <p class="govuk-body">@messages(s"checkYourBenefits.p1.${if(user.isAgent) "agent" else "individual"}")</p>

    @{
        govukInsetText(InsetText(
            content = Text(messages(s"checkYourBenefits.p2.${if(user.isAgent) "agent" else "individual"}", taxYear.toString))
        ))
    }

    @if(benefits.vehicleDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.vehicleHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.car.map{
                BigDecimal => showRows("checkYourBenefits.companyCar", benefits.car)
                },
                benefits.carFuel.map{
                BigDecimal => showRows("checkYourBenefits.fuelForCompanyCar", benefits.carFuel)
                },
                benefits.van.map{
                BigDecimal => showRows("checkYourBenefits.companyVan", benefits.van)
                },
                benefits.vanFuel.map{
                BigDecimal => showRows("checkYourBenefits.fuelForCompanyVan", benefits.vanFuel)
                },
                benefits.mileage.map{
                BigDecimal => showRows("checkYourBenefits.mileageBenefit", benefits.mileage)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.accommodationDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.accommodationHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.accommodation.map{
                BigDecimal => showRows("checkYourBenefits.accommodation", benefits.accommodation)
                },
                benefits.qualifyingRelocationExpenses.map{
                BigDecimal => showRows("checkYourBenefits.qualifyingRelocationCosts", benefits.qualifyingRelocationExpenses)
                },
                benefits.nonQualifyingRelocationExpenses.map{
                BigDecimal => showRows("checkYourBenefits.nonQualifyingRelocationCosts", benefits.nonQualifyingRelocationExpenses)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.travelDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.travelHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.travelAndSubsistence.map{
                BigDecimal => showRows("checkYourBenefits.travelAndSubsistence", benefits.travelAndSubsistence)
                },
                benefits.personalIncidentalExpenses.map{
                BigDecimal => showRows("checkYourBenefits.personalCosts", benefits.personalIncidentalExpenses)
                },
                benefits.entertaining.map{
                BigDecimal => showRows("checkYourBenefits.entertainment", benefits.entertaining)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.utilitiesDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.utilitiesHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.telephone.map{
                BigDecimal => showRows("checkYourBenefits.telephone", benefits.telephone)
                },
                benefits.employerProvidedServices.map{
                BigDecimal => showRows("checkYourBenefits.servicesProvided", benefits.employerProvidedServices)
                },
                benefits.employerProvidedProfessionalSubscriptions.map{
                BigDecimal => showRows("checkYourBenefits.profSubscriptions", benefits.employerProvidedProfessionalSubscriptions)
                },
                benefits.service.map{
                BigDecimal => showRows("checkYourBenefits.otherServices", benefits.service)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.medicalDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.medicalHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.medicalInsurance.map{
                BigDecimal => showRows("checkYourBenefits.medicalIns", benefits.medicalInsurance)
                },
                benefits.nurseryPlaces.map{
                BigDecimal => showRows("checkYourBenefits.nursery", benefits.nurseryPlaces)
                },
                benefits.educationalServices.map{
                BigDecimal => showRows("checkYourBenefits.educational", benefits.educationalServices)
                },
                benefits.beneficialLoan.map{
                BigDecimal => showRows("checkYourBenefits.beneficialLoans", benefits.beneficialLoan)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.incomeTaxDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.incomeTaxHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.incomeTaxPaidByDirector.map{
                BigDecimal => showRows("checkYourBenefits.incomeTaxPaid", benefits.incomeTaxPaidByDirector)
                },
                benefits.paymentsOnEmployeesBehalf.map{
                BigDecimal => showRows("checkYourBenefits.incurredCostsPaid", benefits.paymentsOnEmployeesBehalf)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.reimbursedDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.reimbursedHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.expenses.map{
                BigDecimal => showRows("checkYourBenefits.nonTaxable", benefits.expenses)
                },
                benefits.taxableExpenses.map{
                BigDecimal => showRows("checkYourBenefits.taxableCosts", benefits.taxableExpenses)
                },
                benefits.vouchersAndCreditCards.map{
                BigDecimal => showRows("checkYourBenefits.vouchers", benefits.vouchersAndCreditCards)
                },
                benefits.nonCash.map{
                BigDecimal => showRows("checkYourBenefits.nonCash", benefits.nonCash)
                },
                benefits.otherItems.map{
                BigDecimal => showRows("checkYourBenefits.otherBenefits", benefits.otherItems)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.assetsDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.assetsSubheading")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.assets.map{
                BigDecimal => showRows("checkYourBenefits.assets", benefits.assets)
                },
                benefits.assetTransfer.map{
                BigDecimal => showRows("checkYourBenefits.assetTransfers", benefits.assetTransfer)
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(isInYear) {
        @employmentSource
    }
}

@{
// $COVERAGE-OFF$
}
