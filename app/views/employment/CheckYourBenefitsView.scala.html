@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import views.html.templates.Layout
@import views.html.templates.helpers.Button
@import views.html.templates.helpers.Heading
@import utils.ViewUtils.summaryListRow
@import models.benefits.BenefitsViewModel
@import utils.ViewUtils.bigDecimalCurrency

@this(
    layout: Layout,
    formWithCSRF: FormWithCSRF,
    button: Button,
    heading: Heading,
    govukSummaryList: GovukSummaryList,
    govukInsetText: GovukInsetText,
    govUkButton: GovukButton
)

@(taxYear: Int, benefits: BenefitsViewModel, isSingleEmployment: Boolean, employmentId: String)(implicit user: User[_], messages: Messages, appConfig: AppConfig)

@headingForUse = @{messages(s"checkYourBenefits.heading.${if(user.isAgent) "agent" else "individual"}")}

@titleForUse = @{messages(s"checkYourBenefits.heading.${if(user.isAgent) "agent" else "individual"}")}

@employmentSource = {

            @if(isSingleEmployment) {
                @button("employment.employmentInfo.buttonText", attributes = Map("id" -> "returnToEmploymentSummaryBtn"),
                    href = Some(controllers.employment.routes.EmploymentSummaryController.show(taxYear).url))
                    } else {
                        @button("common.returnToEmployer", attributes = Map("id" -> "returnToEmployerBtn"),
                            href = Some(controllers.employment.routes.EmploymentDetailsAndBenefitsController.show(taxYear, employmentId).url))
            }
}


@showRow(key: String, value: String) = @{
    summaryListRow(
        HtmlContent(messages(key)),
        HtmlContent(value),
        actions = Seq(),
        keyClasses="govuk-!-width-two-thirds",
        valueClasses = "govuk-!-width-one-third right-align")
}

@mapToYesNo(value: Boolean) = @{
    if(value){messages("common.yes")} else {messages("common.no")}
}

@layout(pageTitle = titleForUse, taxYear = Some(taxYear)) {

    @heading(headingForUse, Some(messages("employment.caption", (taxYear - 1).toString, taxYear.toString)), "govuk-!-margin-bottom-5")

    <p class="govuk-body">@messages(s"checkYourBenefits.p1.${if(user.isAgent) "agent" else "individual"}")</p>

    @{
        govukInsetText(InsetText(
            content = Text(messages(s"checkYourBenefits.p2.${if(user.isAgent) "agent" else "individual"}", taxYear.toString))
        ))
    }

    @govukSummaryList(SummaryList(Seq(showRow("checkYourBenefits.benefitsReceived", mapToYesNo(benefits.isBenefitsReceived)))))

    @if(benefits.vehicleDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.vehicleHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.carVanFuelModel.flatMap(_.sectionQuestion).map{
                    question => showRow("checkYourBenefits.carSubheading", mapToYesNo(question))
                },
                benefits.carVanFuelModel.flatMap(_.carQuestion).map{
                    question => showRow("checkYourBenefits.companyCar", mapToYesNo(question))
                },
                benefits.carVanFuelModel.flatMap(_.car).map{
                    amount => showRow("checkYourBenefits.companyCarAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.carVanFuelModel.flatMap(_.carFuelQuestion).map{
                    question => showRow("checkYourBenefits.fuelForCompanyCar", mapToYesNo(question))
                },
                benefits.carVanFuelModel.flatMap(_.carFuel).map{
                    amount => showRow("checkYourBenefits.fuelForCompanyCarAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.carVanFuelModel.flatMap(_.vanQuestion).map{
                    question => showRow("checkYourBenefits.companyVan", mapToYesNo(question))
                },
                benefits.carVanFuelModel.flatMap(_.van).map{
                    amount => showRow("checkYourBenefits.companyVanAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.carVanFuelModel.flatMap(_.vanFuelQuestion).map{
                    question => showRow("checkYourBenefits.fuelForCompanyVan", mapToYesNo(question))
                },
                benefits.carVanFuelModel.flatMap(_.vanFuel).map{
                    amount => showRow("checkYourBenefits.fuelForCompanyVanAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.carVanFuelModel.flatMap(_.mileageQuestion).map{
                    question => showRow("checkYourBenefits.mileageBenefit", mapToYesNo(question))
                },
                benefits.carVanFuelModel.flatMap(_.mileage).map{
                    amount => showRow("checkYourBenefits.mileageBenefitAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.accommodationDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.accommodationHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.accommodationRelocationModel.flatMap(_.sectionQuestion).map{
                    question => showRow("checkYourBenefits.accommodationSubheading", mapToYesNo(question))
                },
                benefits.accommodationRelocationModel.flatMap(_.accommodationQuestion).map{
                    question => showRow("checkYourBenefits.accommodation", mapToYesNo(question))
                },
                benefits.accommodationRelocationModel.flatMap(_.accommodation).map{
                    amount => showRow("checkYourBenefits.accommodationAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.accommodationRelocationModel.flatMap(_.qualifyingRelocationExpensesQuestion).map{
                    question => showRow("checkYourBenefits.qualifyingRelocationCosts", mapToYesNo(question))
                },
                benefits.accommodationRelocationModel.flatMap(_.qualifyingRelocationExpenses).map{
                    amount => showRow("checkYourBenefits.qualifyingRelocationCostsAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.accommodationRelocationModel.flatMap(_.nonQualifyingRelocationExpensesQuestion).map{
                    question => showRow("checkYourBenefits.nonQualifyingRelocationCosts", mapToYesNo(question))
                },
                benefits.accommodationRelocationModel.flatMap(_.nonQualifyingRelocationExpenses).map{
                    amount => showRow("checkYourBenefits.nonQualifyingRelocationCostsAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.travelDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.travelHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.travelEntertainmentModel.flatMap(_.sectionQuestion).map{
                    question => showRow("checkYourBenefits.travelSubheading", mapToYesNo(question))
                },
                benefits.travelEntertainmentModel.flatMap(_.travelAndSubsistenceQuestion).map{
                    question => showRow("checkYourBenefits.travelAndSubsistence", mapToYesNo(question))
                },
                benefits.travelEntertainmentModel.flatMap(_.travelAndSubsistence).map{
                    amount => showRow("checkYourBenefits.travelAndSubsistenceAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.travelEntertainmentModel.flatMap(_.personalIncidentalExpensesQuestion).map{
                    question => showRow("checkYourBenefits.personalCosts", mapToYesNo(question))
                },
                benefits.travelEntertainmentModel.flatMap(_.personalIncidentalExpenses).map{
                    amount => showRow("checkYourBenefits.personalCostsAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.travelEntertainmentModel.flatMap(_.entertainingQuestion).map{
                    question => showRow("checkYourBenefits.entertainment", mapToYesNo(question))
                },
                benefits.travelEntertainmentModel.flatMap(_.entertaining).map{
                    amount => showRow("checkYourBenefits.entertainmentAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.utilitiesDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.utilitiesHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.utilitiesAndServicesModel.flatMap(_.sectionQuestion).map{
                 question => showRow("checkYourBenefits.utilitiesSubheading", mapToYesNo(question))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.telephoneQuestion).map{
                    question => showRow("checkYourBenefits.telephone", mapToYesNo(question))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.telephone).map{
                    amount => showRow("checkYourBenefits.telephoneAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.employerProvidedServicesQuestion).map{
                    question => showRow("checkYourBenefits.servicesProvided", mapToYesNo(question))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.employerProvidedServices).map{
                    amount => showRow("checkYourBenefits.servicesProvidedAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.employerProvidedProfessionalSubscriptionsQuestion).map{
                    question => showRow("checkYourBenefits.profSubscriptions", mapToYesNo(question))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.employerProvidedProfessionalSubscriptions).map{
                    amount => showRow("checkYourBenefits.profSubscriptionsAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.serviceQuestion).map{
                    question => showRow("checkYourBenefits.otherServices", mapToYesNo(question))
                },
                benefits.utilitiesAndServicesModel.flatMap(_.service).map{
                    amount => showRow("checkYourBenefits.otherServicesAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.medicalDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.medicalHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.medicalChildcareEducationModel.flatMap(_.sectionQuestion).map{
                    question => showRow("checkYourBenefits.medicalSubheading", mapToYesNo(question))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.medicalInsuranceQuestion).map{
                    question => showRow("checkYourBenefits.medicalIns", mapToYesNo(question))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.medicalInsurance).map{
                    amount => showRow("checkYourBenefits.medicalInsAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.nurseryPlacesQuestion).map{
                    question => showRow("checkYourBenefits.nursery", mapToYesNo(question))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.nurseryPlaces).map{
                    amount => showRow("checkYourBenefits.nurseryAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.educationalServicesQuestion).map{
                    question => showRow("checkYourBenefits.educational", mapToYesNo(question))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.educationalServices).map{
                    amount => showRow("checkYourBenefits.educationalAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.beneficialLoanQuestion).map{
                    question => showRow("checkYourBenefits.beneficialLoans", mapToYesNo(question))
                },
                benefits.medicalChildcareEducationModel.flatMap(_.beneficialLoan).map{
                    amount => showRow("checkYourBenefits.beneficialLoansAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.incomeTaxDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.incomeTaxHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.incomeTaxAndCostsModel.flatMap(_.sectionQuestion).map{
                    question => showRow("checkYourBenefits.incomeTaxSubheading", mapToYesNo(question))
                },
                benefits.incomeTaxAndCostsModel.flatMap(_.incomeTaxPaidByDirectorQuestion).map{
                    question => showRow("checkYourBenefits.incomeTaxPaid", mapToYesNo(question))
                },
                benefits.incomeTaxAndCostsModel.flatMap(_.incomeTaxPaidByDirector).map{
                    amount => showRow("checkYourBenefits.incomeTaxPaidAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.incomeTaxAndCostsModel.flatMap(_.paymentsOnEmployeesBehalfQuestion).map{
                    question => showRow("checkYourBenefits.incurredCostsPaid", mapToYesNo(question))
                },
                benefits.incomeTaxAndCostsModel.flatMap(_.paymentsOnEmployeesBehalf).map{
                    amount => showRow("checkYourBenefits.incurredCostsPaidAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.reimbursedDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.reimbursedHeader")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.incomeTaxAndCostsModel.flatMap(_.sectionQuestion).map{
                    question => showRow("checkYourBenefits.reimbursedSubheading", mapToYesNo(question))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.expensesQuestion).map{
                    question => showRow("checkYourBenefits.nonTaxable", mapToYesNo(question))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.expenses).map{
                    amount => showRow("checkYourBenefits.nonTaxableAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.taxableExpensesQuestion).map{
                    question => showRow("checkYourBenefits.taxableCosts", mapToYesNo(question))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.taxableExpenses).map{
                    amount => showRow("checkYourBenefits.taxableCostsAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.vouchersAndCreditCardsQuestion).map{
                    question => showRow("checkYourBenefits.vouchers", mapToYesNo(question))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.vouchersAndCreditCards).map{
                    amount => showRow("checkYourBenefits.vouchersAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.nonCashQuestion).map{
                    question => showRow("checkYourBenefits.nonCash", mapToYesNo(question))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.nonCash).map{
                    amount => showRow("checkYourBenefits.nonCashAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.otherItemsQuestion).map{
                    question => showRow("checkYourBenefits.otherBenefits", mapToYesNo(question))
                },
                benefits.reimbursedCostsVouchersAndNonCashModel.flatMap(_.otherItems).map{
                    amount => showRow("checkYourBenefits.otherBenefitsAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

    @if(benefits.assetsDetailsPopulated){
        <h2 class="govuk-label--m govuk-!-margin-top-9">@messages("checkYourBenefits.assetsSubheading")</h2>
        @{
            val rows: Seq[SummaryListRow] = Seq(
                benefits.incomeTaxAndCostsModel.flatMap(_.sectionQuestion).map{
                    question => showRow("checkYourBenefits.assetsSubheading", mapToYesNo(question))
                },
                benefits.assetsModel.flatMap(_.assetsQuestion).map{
                    question => showRow("checkYourBenefits.assets", mapToYesNo(question))
                },
                benefits.assetsModel.flatMap(_.assets).map{
                    amount => showRow("checkYourBenefits.assetsAmount", bigDecimalCurrency(amount.toString))
                },
                benefits.assetsModel.flatMap(_.assetTransferQuestion).map{
                    question => showRow("checkYourBenefits.assetTransfers", mapToYesNo(question))
                },
                benefits.assetsModel.flatMap(_.assetTransfer).map{
                    amount => showRow("checkYourBenefits.assetTransfersAmount", bigDecimalCurrency(amount.toString))
                }
            ).flatten

            govukSummaryList(SummaryList(rows))
        }
    }

        @employmentSource
}

@{
// $COVERAGE-OFF$
}
